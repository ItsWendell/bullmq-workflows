# Roadmap

This roadmap tracks features and improvements for the BullMQ Workflows engine, with comparisons to [Cloudflare Workflows](https://developers.cloudflare.com/workflows/).

## Completed Features âœ“

- [x] **Memory management** - Automatically evict instances from memory when completed, paused, terminated, or waiting
- [x] **Event-driven workflows** - `step.waitForEvent()` for human-in-the-loop and webhook patterns
- [x] **Batch operations** - `createBatch()` for creating multiple workflow instances efficiently
- [x] **Priority system** - Workflows resuming from sleep or receiving events are prioritized over new workflows
- [x] **Benchmarking suite** - Comprehensive performance testing framework
- [x] **Core workflow primitives**:
  - âœ“ `WorkflowEntrypoint` with `run()` method
  - âœ“ `step.do()`, `step.sleep()`, `step.sleepUntil()`, `step.waitForEvent()`
  - âœ“ `create()`, `createBatch()`, `get()`
  - âœ“ `pause()`, `resume()`, `restart()`, `terminate()`, `sendEvent()`
  - âœ“ State persistence and recovery
  - âœ“ `NonRetryableError` for non-retryable failures

## Step-Level Features

- [x] **Step retry configuration with backoff strategies** (ğŸ”— [CF Docs](https://developers.cloudflare.com/workflows/build/workers-api/#workflowstepconfig))

  - âœ… Implement `WorkflowStepConfig.retries` with:
    - âœ… `limit` - max retry attempts per step
    - âœ… `delay` - delay between retries (duration or number)
    - âœ… `backoff` - strategy: "constant", "linear", "exponential"
  - âœ… Retry state persisted in Redis across workflow restarts
  - âœ… `NonRetryableError` bypasses retries
  - âœ… `StepRetriesExceededError` with detailed error context
  - âœ… Comprehensive test coverage

- [x] **Step timeout enforcement** (ğŸ”— [CF Docs](https://developers.cloudflare.com/workflows/build/workers-api/#workflowstepconfig))

  - âœ… Implement `WorkflowStepConfig.timeout`
  - âœ… Automatically fail steps that exceed timeout duration
  - âœ… `StepTimeoutError` thrown on timeout
  - âœ… Works in combination with retry logic
  - âœ… Comprehensive test coverage

- [ ] **Promise.race() support for waitForEvent**
  - Allow waiting for multiple events simultaneously
  - First event to arrive wins
  - Cancel remaining event waiters

## Workflow Management

- [ ] **Concurrency limits** (ğŸ”— [CF Docs](https://developers.cloudflare.com/workflows/platform/limits/))

  - Per-workflow concurrency controls
  - Queue instances when limit is reached
  - Add `queued` status for waiting instances
  - Configurable via `WorkflowEngineConfig`

- [ ] **"waitingForPause" status** (ğŸ”— [CF Docs](https://developers.cloudflare.com/workflows/build/workers-api/#instancestatus))

  - Add status for instances finishing current step before pausing
  - Improves UX by showing pause is in progress

## API & Integrations

- [ ] **REST API** (ğŸ”— [CF Docs](https://developers.cloudflare.com/api/resources/workflows/))

  - HTTP API for managing workflows
  - Endpoints: create, get, pause, resume, restart, terminate, sendEvent
  - Authentication/authorization
  - OpenAPI specification

- [ ] **Type validation helpers**

  - Integration with validation libraries (zod, yup, etc.)
  - Validate `WorkflowEvent.payload` at runtime
  - Type-safe event payloads
  - Automatic error handling for validation failures

- [ ] **Add support for waitUntil**
  - Similar to Cloudflare Workers API `ctx.waitUntil()`
  - Wait for promises before workflow shutdown
  - Ensures cleanup tasks complete

## Observability & Monitoring

- [ ] **Built-in metrics and analytics** (ğŸ”— [CF Docs](https://developers.cloudflare.com/workflows/observability/metrics-analytics/))

  - Execution time per workflow/step
  - Success/failure rates
  - Retry statistics
  - Queue depth and throughput
  - Integration with Prometheus/Grafana

- [ ] **Structured logging and tracing** (ğŸ”— [CF Docs](https://developers.cloudflare.com/workflows/observability/))

  - OpenTelemetry support
  - Distributed tracing across steps
  - Structured log output (JSON)
  - Correlation IDs
  - Integration with observability platforms (Datadog, New Relic, etc.)

- [ ] **Dashboard/UI**
  - Visual workflow monitoring
  - Instance timeline view
  - Step execution visualization
  - Real-time status updates
  - Search and filter instances
  - Metrics dashboards

## Developer Experience

- [ ] **CLI tools**

  - Local development mode
  - Workflow testing utilities
  - Deployment commands
  - Log streaming
  - Instance management from terminal

- [ ] **Local development improvements**

  - Hot reload for workflow changes
  - Mock event sending
  - Time travel debugging
  - Step-by-step execution mode

- [ ] **Testing utilities**
  - Test helpers for workflow testing
  - Mock `WorkflowStep` implementation
  - Time manipulation for sleep/timeout testing
  - Event simulation
  - Assertion helpers

## Documentation & Examples

- [ ] **Interactive examples**

  - More real-world workflow patterns
  - E-commerce order processing
  - User onboarding flows
  - Data pipeline orchestration
  - API aggregation patterns

- [ ] **Best practices documentation**
  - Idempotency patterns
  - Error handling strategies
  - Performance optimization
  - Security considerations

## Performance & Reliability

- [ ] **Workflow versioning** (ğŸ”— [Dynamic Deployment Guide](./docs/DYNAMIC_DEPLOYMENT.md))

  - Deploy new workflow versions without breaking running instances
  - Version-specific execution
  - Gradual rollout/canary deployments
  - Hot reload capabilities for zero-downtime updates
  - Multiple deployment strategies: versioned registry, dynamic loading, Redis-backed

- [ ] **Dead letter queues**

  - Automatically move failed instances to DLQ
  - Configurable failure thresholds
  - DLQ inspection and replay

- [ ] **Circuit breaker pattern**
  - Prevent cascading failures
  - Automatic service degradation
  - Configurable thresholds and recovery

## Infrastructure

- [ ] **Multi-region support**

  - Deploy workflows across regions
  - Automatic failover
  - Data locality compliance

- [ ] **Autoscaling**
  - Automatic worker scaling based on queue depth
  - CPU/memory-based scaling
  - Integration with container orchestration (K8s, ECS)

---

## Comparison with Cloudflare Workflows

| Feature                     | BullMQ Workflows | Cloudflare Workflows |
| --------------------------- | ---------------- | -------------------- |
| Core workflow primitives    | âœ…               | âœ…                   |
| Event-driven (waitForEvent) | âœ…               | âœ…                   |
| Sleep/delay                 | âœ…               | âœ…                   |
| Batch creation              | âœ…               | âœ…                   |
| Pause/resume/restart        | âœ…               | âœ…                   |
| Priority system             | âœ…               | âŒ                   |
| Step retries with backoff   | âœ…               | âœ…                   |
| Step timeouts               | âœ…               | âœ…                   |
| Concurrency limits          | âŒ               | âœ…                   |
| REST API                    | âŒ               | âœ…                   |
| Dashboard/UI                | âŒ               | âœ…                   |
| Metrics/analytics           | âš ï¸ Basic         | âœ…                   |
| Cron triggers               | âŒ               | âœ…                   |
| Open source                 | âœ…               | âŒ                   |
| Self-hosted                 | âœ…               | âŒ                   |

**Legend:** âœ… Available | âš ï¸ Partially implemented | âŒ Not available

# Other

- [ ] Improve (error) serialization and deserialization (maybe look into superjson?)
